# Dockerfile for OpenCode Sandbox Container
# Extends Cloudflare Sandbox base image with OpenCode CLI
FROM docker.io/cloudflare/sandbox:0.5.3

# Install OpenCode CLI globally
RUN npm install -g opencode-ai

ENV NODE_EXTRA_CA_CERTS="/etc/ssl/certs/Cloudflare_CA.pem"

# Install WARP certs if script exists (optional for internal users)
COPY src/internal-scripts /tmp/internal-scripts
RUN if [ -f /tmp/internal-scripts/install-cloudflare-warp-certs.sh ]; then \
    chmod +x /tmp/internal-scripts/install-cloudflare-warp-certs.sh && \
    /tmp/internal-scripts/install-cloudflare-warp-certs.sh || true; \
  fi && rm -rf /tmp/internal-scripts

# Ports: 3000 (Sandbox API), 4096 (OpenCode server)
EXPOSE 3000 4096
